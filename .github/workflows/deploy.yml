name: 🚀 LazyLogic Static Deploy to Netlify (Optimized)
on:
  push:
    branches: [ master ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 🧾 Checkout repo
        uses: actions/checkout@v3
      - name: ⚙️ Install html-minifier and terser
        run: |
          sudo apt-get update -y
          sudo apt-get install -y npm
          npm install -g html-minifier-terser clean-css-cli terser
      - name: 🧹 Minify HTML, CSS, JS
        run: |
          find public -name '*.html' -exec html-minifier-terser --collapse-whitespace --remove-comments --minify-js true --minify-css true -o {} {} \;
          find public -name '*.css' -exec cleancss -o {} {} \;
          find public -name '*.js' -exec terser -c -m -o {} -- {} \;
      - name: 🚀 Deploy to Netlify
        uses: nwtgck/actions-netlify@v2
        with:
          publish-dir: ./public
          production-deploy: true
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
